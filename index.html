<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GitHub Music Player</title>
  <style>
    body {
      font-family: sans-serif;
      background: #0f0f0f;
      color: #eee;
      text-align: center;
      padding: 2rem;
    }

    ul { list-style: none; padding: 0; }
    li { margin: 10px 0; }

    button {
      margin: 0.2rem;
      padding: 0.5rem 1rem;
      background: #222;
      color: #1db954;
      border: 1px solid #333;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background: #1db954;
      color: #111;
    }

    audio { display: none; }

    img.cover {
      max-width: 250px;
      border-radius: 16px;
      box-shadow: 0 0 10px #000;
      margin-top: 2rem;
    }

    canvas {
      margin-top: 1rem;
      width: 80%;
      height: 100px;
      background: #1a1a1a;
      border-radius: 8px;
    }

    .progress-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 1rem;
      width: 80%;
      margin-inline: auto;
    }

    .time-label {
      font-size: 0.9rem;
      width: 50px;
      text-align: center;
    }

    .progress-bar {
      flex-grow: 1;
      height: 8px;
      background: #333;
      border-radius: 4px;
      position: relative;
      cursor: pointer;
      margin: 0 10px;
    }

    .progress {
      height: 100%;
      background: #1db954;
      border-radius: 4px;
      width: 0%;
    }

    .volume-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 1rem;
      gap: 10px;
    }

    #volumeSlider {
      width: 150px;
      appearance: none;
      height: 6px;
      background: #1db954;
      border-radius: 3px;
      cursor: pointer;
    }

    #volumeSlider::-webkit-slider-thumb {
      appearance: none;
      width: 12px;
      height: 12px;
      background: #fff;
      border-radius: 50%;
      border: 1px solid #000;
    }

    #muteBtn {
      background: transparent;
      color: #1db954;
      font-size: 1.2rem;
      cursor: pointer;
      border: none;
    }

    .hide-button {
      margin-top: 1rem;
      background-color: #444;
      padding: 0.5rem;
    }

    .track-list {
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h1>üéµ GitHub Music Player</h1>

  <div>
    <button onclick="prevTrack()">‚èÆÔ∏è Prev</button>
    <button onclick="toggleShuffle()">üîÄ Shuffle: <span id="shuffleStatus">Off</span></button>
    <button onclick="nextTrack()">‚è≠Ô∏è Next</button>
    <button onclick="togglePlayPause()" id="playPauseBtn">‚èØÔ∏è Play</button>
    <button class="hide-button" onclick="toggleTrackList()">üîΩ Hide Track List</button>
  </div>

  <div class="track-list" id="trackListContainer">
    <ul id="trackList"></ul>
  </div>

  <img id="albumCover" class="cover" src="" alt="Album cover" />

  <div class="progress-container">
    <div class="time-label" id="currentTime">0:00</div>
    <div class="progress-bar" id="progressBar">
      <div class="progress" id="progress"></div>
    </div>
    <div class="time-label" id="totalTime">0:00</div>
  </div>

  <div class="volume-container">
    <button id="muteBtn">üîä</button>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">
  </div>

  <audio id="audioPlayer" controls crossorigin="anonymous"></audio>

  <canvas id="visualizer"></canvas>

  <script>
    const username = "Swayam06012005"; // ‚Üê Replace with your GitHub username
    const repo = "music-repo";       // ‚Üê Replace with your repo name
    const folder = "Songs";
    const branch = "main";

    const apiURL = `https://api.github.com/repos/${username}/${repo}/contents/${folder}?ref=${branch}`;
    const rawBase = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/${folder}/`;

    const trackListElem = document.getElementById('trackList');
    const audioPlayer = document.getElementById('audioPlayer');
    const albumCover = document.getElementById('albumCover');
    const shuffleStatus = document.getElementById('shuffleStatus');
    const canvas = document.getElementById('visualizer');
    const ctx = canvas.getContext('2d');
    const currentTimeLabel = document.getElementById('currentTime');
    const totalTimeLabel = document.getElementById('totalTime');
    const progressBar = document.getElementById('progressBar');
    const progress = document.getElementById('progress');
    const volumeSlider = document.getElementById('volumeSlider');
    const muteBtn = document.getElementById('muteBtn');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const trackListContainer = document.getElementById('trackListContainer');

    let files = [], tracks = [];
    let currentIndex = 0;
    let shuffle = false;

    fetch(apiURL)
      .then(res => res.json())
      .then(data => {
        files = data;
        tracks = data.filter(file => file.name.endsWith('.mp3') || file.name.endsWith('.wav')).map(file => file.name);
        if (tracks.length === 0) {
          trackListElem.innerHTML = "<li>No audio files found.</li>";
          return;
        }
        renderTrackList();
        loadTrack(currentIndex);
      })
      .catch(err => {
        console.error("Failed to fetch files:", err);
        trackListElem.innerHTML = "<li>Error loading songs.</li>";
      });

    function renderTrackList() {
      trackListElem.innerHTML = "";
      tracks.forEach((track, index) => {
        const li = document.createElement('li');
        const btn = document.createElement('button');
        btn.textContent = track;
        btn.onclick = () => {
          currentIndex = index;
          loadTrack(currentIndex);
          audioPlayer.play();
        };
        li.appendChild(btn);
        trackListElem.appendChild(li);
      });
    }

    function loadTrack(index) {
      const trackName = tracks[index];
      audioPlayer.src = `${rawBase}${trackName}`;
      audioPlayer.play();  // Autoplay the track when loaded

      const baseName = trackName.replace(/\.[^/.]+$/, "");
      const coverFile = files.find(f => f.name === `${baseName}.jpg`) || files.find(f => f.name === `default.jpg`);
      albumCover.src = coverFile ? `${rawBase}${coverFile.name}` : "";

      audioPlayer.load();
    }

    function nextTrack() {
      currentIndex = shuffle ? Math.floor(Math.random() * tracks.length) : (currentIndex + 1) % tracks.length;
      loadTrack(currentIndex);
    }

    function prevTrack() {
      currentIndex = (currentIndex - 1 + tracks.length) % tracks.length;
      loadTrack(currentIndex);
    }

    function toggleShuffle() {
      shuffle = !shuffle;
      shuffleStatus.textContent = shuffle ? "On" : "Off";
    }

    function togglePlayPause() {
      if (audioPlayer.paused) {
        audioPlayer.play();
        playPauseBtn.textContent = "‚è∏Ô∏è Pause";
      } else {
        audioPlayer.pause();
        playPauseBtn.textContent = "‚ñ∂Ô∏è Play";
      }
    }

    audioPlayer.addEventListener('ended', nextTrack);

    // üéß Visualizer
    let audioCtx, analyser, source, bufferLength, dataArray;
    audioPlayer.addEventListener('play', () => {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        source = audioCtx.createMediaElementSource(audioPlayer);
        source.connect(analyser);
        analyser.connect(audioCtx.destination);
        analyser.fftSize = 256;
        bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
      }
      animateVisualizer();
    });

    function animateVisualizer() {
      requestAnimationFrame(animateVisualizer);
      if (!analyser) return;
      analyser.getByteFrequencyData(dataArray);

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const barWidth = (canvas.width / bufferLength) * 2.5;
      let x = 0;
      for (let i = 0; i < bufferLength; i++) {
        const barHeight = dataArray[i] / 2;
        const r = 100 + barHeight + (i * 2);
        const g = 50 + i * 2;
        const b = 200;
        ctx.fillStyle = `rgb(${r},${g},${b})`;
        ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
        x += barWidth + 1;
      }
    }

    // ‚è± Progress Bar Logic
    audioPlayer.addEventListener('timeupdate', updateProgress);
    audioPlayer.addEventListener('loadedmetadata', updateProgress);

    function updateProgress() {
      const current = audioPlayer.currentTime;
      const total = audioPlayer.duration || 0;

      progress.style.width = `${(current / total) * 100}%`;
      currentTimeLabel.textContent = formatTime(current);
      totalTimeLabel.textContent = formatTime(total);
    }

    function formatTime(time) {
      if (isNaN(time)) return "0:00";
      const minutes = Math.floor(time / 60);
      const seconds = Math.floor(time % 60).toString().padStart(2, '0');
      return `${minutes}:${seconds}`;
    }

    // üéØ Seek support
    progressBar.addEventListener('click', (e) => {
      const width = progressBar.clientWidth;
      const clickX = e.offsetX;
      const duration = audioPlayer.duration;
      audioPlayer.currentTime = (clickX / width) * duration;
    });

    // üîä Volume control
    volumeSlider.addEventListener('input', () => {
      audioPlayer.volume = volumeSlider.value;
    });

    muteBtn.addEventListener('click', () => {
      audioPlayer.muted = !audioPlayer.muted;
      muteBtn.textContent = audioPlayer.muted ? "üîá" : "üîä";
    });

    // üõë Hide Track List
    function toggleTrackList() {
      trackListContainer.style.display = trackListContainer.style.display === 'none' ? 'block' : 'none';
    }
  </script>
</body>
</html>
